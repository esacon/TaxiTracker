<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taxi App Tracker</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>    
    <script src="./socket.io/socket.io.js" charset="utf-8"></script>
</head>
<body>
    <header class="taxi_app">
        <div class="taxi_info">
            <h1>Taxi Tracker App</h1>
            <p id="descripcion">Coordenadas:</p>
        </div>
    </header>

    <main class="main">
        <section class="coordenadas info">
            <p class="latitud">Latitud: <span id="latitud_text"></span></p>
            <p class="longitud">Longitud: <span id="longitud_text"></span></p>
            <p class="fecha">Fecha: <span id="fecha_text"></span></p>
            <p class="hora">Hora: <span id="hora_text"></span></p>
        </section>

        <!-- Map section -->
        <section class="map">
            <div id ="mapid"></div>
        </section>

        <script>         

            var socket = io();
            var marker;
            var circle;
            var map = L.map('mapid');


            // Polilínea.
            socket.on('getData', function(data) {
                console.log('últimos datos: ')
                console.log([parseFloat(data.latitud), parseFloat(data.longitud)]);      
                map.setView([parseFloat(data.latitud), parseFloat(data.longitud)], 18);  

                L.tileLayer('https://api.maptiler.com/maps/streets/{z}/{x}/{y}.png?key=mAWo6ZVOwQECEfInDbLo', {
                        attribution:'<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>',
                        maxZoom: 20,
                        center: [parseFloat(data.latitud), parseFloat(data.longitud)],
                        tileSize: 512,
                        zoomOffset: -1,
                    }).addTo(map);   

                circle = L.circle([parseFloat(data.latitud), parseFloat(data.longitud)], {
                            color: 'green',
                            fillColor: '#00ff00',
                            fillOpacity: 0.3,
                            radius: 50
                        }).addTo(map);

                marker = L.marker([parseFloat(data.latitud), parseFloat(data.longitud)]).addTo(map);             
            });                
                
            let polyline = L.polyline([], {color: '#41b611', smoothFactor:3}).addTo(map);

            document.addEventListener('DOMContentLoaded', function() {
                socket.on('change', function(info) {

                    document.getElementById('latitud_text').innerText = info.latitud_text;
                    document.getElementById('longitud_text').innerText = info.longitud_text;
                    document.getElementById('fecha_text').innerText = info.fecha_text;
                    document.getElementById('hora_text').innerText = info.hora_text;

                    // Initialize map.
                    map.setView([parseFloat(info.latitud_text), parseFloat(info.longitud_text)]);                        
                    polyline.addLatLng([parseFloat(info.latitud_text), parseFloat(info.longitud_text)]);
                    marker.setLatLng([parseFloat(info.latitud_text), parseFloat(info.longitud_text)]);
                    circle.setLatLng([parseFloat(info.latitud_text), parseFloat(info.longitud_text)]);
                });
            }); 
        </script>
    </main>
    <footer class="footer">
        <p class="footer_copyright">
            Sitio web creado por &copy; Blondis Barrios, Adriana Díaz, Enrique Niebles, Sebastián Romero, y Jesús Suárez.
        </p>
    </footer>
</body>
</html>
